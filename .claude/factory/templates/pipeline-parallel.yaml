# Parallel Pipeline Template
# Generated by Neuron Factory
# Path: .claude/pipelines/{{name}}.yaml

name: "{{name}}"
description: "{{description}}"
module: "{{module}}"

# ═══════════════════════════════════════════════════════════════════════════════
# PIPELINE CONFIGURATION
# ═══════════════════════════════════════════════════════════════════════════════

config:
  # Execution mode: parallel | sequential | mixed
  mode: parallel

  # Maximum concurrent tasks (for parallel mode)
  max_concurrency: "{{max_concurrency}}"  # Replace with number, e.g., 4

  # Timeout per task (ms)
  task_timeout: "{{task_timeout}}"  # Replace with number, e.g., 30000

  # Pipeline timeout (ms)
  pipeline_timeout: "{{pipeline_timeout}}"  # Replace with number, e.g., 300000

# ═══════════════════════════════════════════════════════════════════════════════
# STAGES - Ordered phases of execution
# ═══════════════════════════════════════════════════════════════════════════════

stages:
  # {{#stages}}
  - name: "{{name}}"
    description: "{{description}}"

    # Tasks within this stage (executed based on dependencies)
    tasks:
      # {{#tasks}}
      - id: "{{id}}"
        name: "{{name}}"
        agent: "{{agent}}"  # or skill: "{{skill}}"

        # Input mapping from pipeline context or previous tasks
        input:
          # {{#input}}
          # {{key}}: "{{source}}"
          # {{/input}}

        # Dependencies (task IDs that must complete first)
        depends_on: []
          # - task_id_1
          # - task_id_2

        # Output mapping to pipeline context
        output:
          # {{#output}}
          # {{key}}: "{{target}}"
          # {{/output}}
      # {{/tasks}}

    # Stage success criteria
    success_criteria:
      # - "All tasks completed"
      # - "No errors"
  # {{/stages}}

# ═══════════════════════════════════════════════════════════════════════════════
# DEPENDENCY GRAPH - Visual representation
# ═══════════════════════════════════════════════════════════════════════════════

# > P19 Visual Architecture: Express architecture as diagrams
#
# {{dependency_graph}}
#
# Example:
# ┌─────────┐     ┌─────────┐
# │ Task A  │────▶│ Task C  │
# └─────────┘     └────┬────┘
#                      │
# ┌─────────┐          │
# │ Task B  │──────────┘
# └─────────┘

# ═══════════════════════════════════════════════════════════════════════════════
# ERROR STRATEGY
# ═══════════════════════════════════════════════════════════════════════════════

error_strategy:
  # On task failure: stop | continue | retry
  on_failure: "{{on_failure}}"

  # Retry configuration
  retry:
    max_attempts: "{{retry_max_attempts}}"  # Replace with number, e.g., 3
    backoff_ms: "{{retry_backoff_ms}}"  # Replace with number, e.g., 1000
    backoff_multiplier: "{{retry_backoff_multiplier}}"  # Replace with number, e.g., 2

  # Rollback behavior
  rollback:
    enabled: "{{rollback_enabled}}"  # Replace with boolean, e.g., true
    # Tasks to execute on rollback (in reverse order)
    tasks: []
      # - rollback_task_1

# ═══════════════════════════════════════════════════════════════════════════════
# OUTPUT
# ═══════════════════════════════════════════════════════════════════════════════

output:
  # Fields collected from task outputs
  fields:
    # {{#output_fields}}
    # - name: "{{name}}"
    #   from_task: "{{task_id}}"
    #   field: "{{field}}"
    # {{/output_fields}}

  # Summary format
  summary:
    include_timing: true
    include_task_results: true

# ═══════════════════════════════════════════════════════════════════════════════
# METADATA
# ═══════════════════════════════════════════════════════════════════════════════

_meta:
  created: "{{date}}"
  created_by: factory
  template: pipeline-parallel
  version: 1
